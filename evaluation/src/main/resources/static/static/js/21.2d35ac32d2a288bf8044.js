webpackJsonp([21],{G6mj:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=s("woOf"),a=s.n(l),i=s("VR4j"),o=s("4b3y"),n=s("VLUi"),r=s("vLgD");var c=s("ts7I"),d=s("zL8q"),u=s("d2gY"),f={keyword:null,word:null,blurry:!1,page:1,limit:5},p={name:"classList",data:function(){return{editSkuInfo:{dialogVisible:!1,keyword:null},operateType:null,listQuery:a()({},f),list:null,total:null,listLoading:!0,selectProductCateValue:null,multipleSelection:[],facultyList:[],professionList:[],teacherList:[],editDialog:!1,classModel:{profession:{faculty:{}},teacher:{}},dialogTitle:"",showImportTask:!1,uploadUrl:u.a}},created:function(){this.getList(),this.getFacultyList(),this.getFetchTeacherList()},watch:{},methods:{getList:function(){var e,t=this;this.listLoading=!0,this.listQuery.quire=" and 1 = 1",this.listQuery.keyword&&(this.listQuery.quire+=" and  classCoding like '%"+this.listQuery.keyword+"%'"),this.listQuery.facultyId&&!this.listQuery.professionId&&(this.listQuery.quire+=" and professionId in (select id from profession where facultyId = "+this.listQuery.facultyId+")"),this.listQuery.professionId&&!this.listQuery.classid&&(this.listQuery.quire+=" and professionId = "+this.listQuery.professionId),(e=this.listQuery,Object(r.a)({url:"/class/quire/list",method:"get",params:e})).then(function(e){t.listLoading=!1,t.list=[];var s=e.data.data;s.forEach(function(e){e.profession={},e.teacher={},Object(i.f)(e.professionId).then(function(l){var a=l.data;a&&Object(o.d)(a.facultyId).then(function(l){a.faculty=l.data,e.profession=a,t.list=s})}),console.log("获取到的班级信息为",e),e.teacherId?Object(n.d)(e.teacherId).then(function(t){return e.teacher=t.data}):e.teacher.name="无"}),t.total=e.data.total})},getFacultyList:function(){var e=this;Object(c.f)({}).then(function(t){e.facultyList=t.data.data})},getFetchTeacherList:function(){var e=this;Object(i.e)({quire:"and 1 = 1"}).then(function(t){e.teacherList=t.data.data})},getProfessionList:function(e){var t=this;this.professionList=[],Object(c.h)({quire:" and facultyId = "+(e||this.listQuery.facultyId)}).then(function(s){var l=s.data.data;l&&l.length>0&&(e?t.classModel.professionId=l[0].id:t.listQuery.professionId=l[0].id),t.professionList=l})},handleSizeChange:function(e){this.listQuery.page=1,this.listQuery.limit=e,this.getList()},handleCurrentChange:function(e){this.listQuery.page=e,this.getList()},handleSelectionChange:function(e){this.multipleSelection=e},handleResetSearch:function(){this.selectProductCateValue=[],this.listQuery=a()({},f),this.getList()},getTheacher:function(e){return this.teacherList.filter(function(t){return t.id===e})[0]},handleDelete:function(e,t){var s=this;this.$confirm("是否要进行删除操作?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var e,l=t?[t.id]:[];s.multipleSelection.forEach(function(e){return l.push(e.id)}),console.log(l),(e={ids:l.toString()},Object(r.a)({url:"/class/delete",method:"delete",params:e})).then(function(e){s.getList()})})},edit:function(){var e,t=this,s=this.classModel;s.id?(e=s,Object(r.a)({url:"/class/update",method:"put",params:e})).then(function(e){t.editDialog=!1,t.getList(),Object(d.Message)({message:"修改成功",type:"success",duration:1e3})}):(console.log("需要添加的班级信息为：",this.classModel),function(e){return Object(r.a)({url:"/class/add",method:"post",params:e})}(this.classModel).then(function(e){t.editDialog=!1,t.getList(),Object(d.Message)({message:"添加成功",type:"success",duration:1e3})}))},uploadTaskSuccess:function(){this.$message({message:"班级信息上传成功",type:"success"}),this.getList()},uploadTaskError:function(){this.$message({message:"班级信息上传失败",type:"error"})}}},h={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"app-container",staticStyle:{height:"500px","overflow-y":"scroll"}},[s("el-card",{staticClass:"filter-container",attrs:{shadow:"never"}},[s("div",[s("i",{staticClass:"el-icon-search"}),e._v(" "),s("span",[e._v("筛选搜索")]),e._v(" "),s("el-button",{staticStyle:{float:"right"},attrs:{type:"primary",size:"small"},on:{click:function(t){e.getList()}}},[e._v("查询结果")]),e._v(" "),s("el-button",{staticStyle:{float:"right","margin-right":"15px"},attrs:{size:"small"},on:{click:function(t){e.handleResetSearch()}}},[e._v("重置\n      ")])],1),e._v(" "),s("div",{staticStyle:{"margin-top":"15px"}},[s("el-form",{attrs:{inline:!0,model:e.listQuery,size:"small","label-width":"140px"}},[s("el-form-item",{attrs:{label:"输入搜索："}},[s("el-input",{staticStyle:{width:"203px"},attrs:{placeholder:"关键字"},model:{value:e.listQuery.keyword,callback:function(t){e.$set(e.listQuery,"keyword",t)},expression:"listQuery.keyword"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"学院："}},[s("el-select",{attrs:{placeholder:"请选择学院",clearable:"",filterable:""},on:{change:function(t){e.listQuery.professionId=null,e.getProfessionList()}},model:{value:e.listQuery.facultyId,callback:function(t){e.$set(e.listQuery,"facultyId",t)},expression:"listQuery.facultyId"}},e._l(e.facultyList,function(e){return s("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}))],1),e._v(" "),s("el-form-item",{attrs:{label:"专业："}},[s("el-select",{attrs:{placeholder:"请选择专业",clearable:"",filterable:""},model:{value:e.listQuery.professionId,callback:function(t){e.$set(e.listQuery,"professionId",t)},expression:"listQuery.professionId"}},e._l(e.professionList,function(e){return s("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}))],1)],1)],1)]),e._v(" "),s("el-dialog",{attrs:{title:"上传班级信息",visible:e.showImportTask,width:"30%"},on:{"update:visible":function(t){e.showImportTask=t}}},[s("el-upload",{staticClass:"upload-demo",attrs:{drag:"","on-success":e.uploadTaskSuccess,"on-error":e.uploadTaskError,action:e.uploadUrl,multiple:"",headers:"{'Content-Type':'application/x-www-form-urlencoded'}",name:"classFile"}},[s("i",{staticClass:"el-icon-upload"}),e._v(" "),s("div",{staticClass:"el-upload__text"},[e._v("将文件拖到此处，或"),s("em",[e._v("点击上传")])]),e._v(" "),s("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("请规范excel格式，不然无法导入")])]),e._v(" "),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{type:"primary"},on:{click:function(t){e.showImportTask=!1}}},[e._v("确 定")])],1)],1),e._v(" "),s("el-card",{staticClass:"operate-container",attrs:{shadow:"never"}},[s("i",{staticClass:"el-icon-tickets"}),e._v(" "),s("span",[e._v("班级数据")]),e._v(" "),s("el-button",{staticClass:"btn-add",attrs:{size:"mini"},on:{click:function(t){e.classModel={profession:{faculty:{}},teacher:{}},e.editDialog=!0,e.dialogTitle="添加"}}},[e._v("添加\n    ")]),e._v(" "),s("el-button",{staticClass:"btn-add",attrs:{type:"success",size:"mini"},on:{click:function(t){e.showImportTask=!0}}},[e._v("导入班级信息\n    ")])],1),e._v(" "),s("div",{staticClass:"table-container"},[s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],staticStyle:{width:"100%"},attrs:{data:e.list,border:""},on:{"selection-change":e.handleSelectionChange}},[s("el-table-column",{attrs:{type:"selection",width:"60",align:"center"}}),e._v(" "),s("el-table-column",{attrs:{label:"编号",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.classCoding))]}}])}),e._v(" "),s("el-table-column",{attrs:{label:"指导老师",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.teacher?t.row.teacher.name:"无"))]}}])}),e._v(" "),s("el-table-column",{attrs:{label:"专业",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.profession?t.row.profession.name:"无"))]}}])}),e._v(" "),s("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-button",{attrs:{size:"mini"},on:{click:function(s){e.classModel=t.row,e.editDialog=!0,e.classModel.type="see",e.dialogTitle="查看"}}},[e._v("查看\n          ")]),e._v(" "),s("el-button",{attrs:{size:"mini"},on:{click:function(s){e.classModel=t.row,e.editDialog=!0,e.dialogTitle="编辑",e.classModel.type="edit",e.getProfessionList(e.classModel.profession.faculty.id)}}},[e._v("编辑\n          ")])]}}])})],1)],1),e._v(" "),s("div",{staticClass:"pagination-container"},[s("el-pagination",{attrs:{background:"",layout:"total, sizes,prev, pager, next,jumper","page-size":e.listQuery.limit,"page-sizes":[5,10,15],"current-page":e.listQuery.page,total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange,"update:currentPage":function(t){e.$set(e.listQuery,"page",t)}}})],1),e._v(" "),s("el-dialog",{attrs:{title:e.dialogTitle,visible:e.editDialog,width:"30%"},on:{"update:visible":function(t){e.editDialog=t}}},[s("el-form",{attrs:{"label-width":"80px"}},[s("el-form-item",{attrs:{label:"班级编号"}},[s("el-input",{attrs:{disabled:"see"===e.classModel.type},model:{value:e.classModel.classCoding,callback:function(t){e.$set(e.classModel,"classCoding",t)},expression:"classModel.classCoding"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"学院："}},[s("el-select",{attrs:{placeholder:"请选择学院",clearable:"",filterable:"",disabled:"see"===e.classModel.type},on:{change:function(t){e.classModel.professionId=null,e.getProfessionList(e.classModel.profession.faculty.id)}},model:{value:e.classModel.profession.faculty.id,callback:function(t){e.$set(e.classModel.profession.faculty,"id",t)},expression:"classModel.profession.faculty.id"}},e._l(e.facultyList,function(e){return s("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}))],1),e._v(" "),s("el-form-item",{attrs:{label:"专业："}},[s("el-select",{attrs:{placeholder:"请选择专业",clearable:"",filterable:"",disabled:"see"===e.classModel.type},model:{value:e.classModel.professionId,callback:function(t){e.$set(e.classModel,"professionId",t)},expression:"classModel.professionId"}},e._l(e.professionList,function(e){return s("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}))],1),e._v(" "),s("el-form-item",{attrs:{label:"指导老师："}},[s("el-select",{attrs:{placeholder:"请选指导老师",clearable:"",filterable:"",disabled:"see"===e.classModel.type},model:{value:e.classModel.teacherId,callback:function(t){e.$set(e.classModel,"teacherId",t)},expression:"classModel.teacherId"}},e._l(e.teacherList,function(e){return s("el-option",{key:e.accountId,attrs:{label:e.name,value:e.accountId}})}))],1)],1),e._v(" "),"see"!==e.classModel.type?s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.editDialog=!1}}},[e._v("取 消")]),e._v(" "),s("el-button",{attrs:{type:"primary"},on:{click:function(t){e.edit()}}},[e._v("确 定")])],1):e._e()],1)],1)},staticRenderFns:[]},y=s("VU/8")(p,h,!1,null,null,null);t.default=y.exports}});
//# sourceMappingURL=21.2d35ac32d2a288bf8044.js.map